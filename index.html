<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
		  <script src="js/jquery.min.js"></script>
    <script src="js/bmobSocketIo.js"></script>
    <script src="js/bmob.js"></script>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
	function abc(){
var now=new Date();
var year=now.getFullYear();
    var month=now.getMonth()+1; //js获取的月份是从0开始；
    var day=now.getDate();
	  document.getElementById("show").innerHTML=""+year+"年"+month+"月"+day+"日 ";
}
    </script>
		<script src="bmob-min.js"></script>
</head>
<body>
	


<div class="mui-content-padded" style="margin: 5px;text-align: left;">
			
				<button id='promptBtn' type="button" class="mui-btn mui-btn-blue mui-btn-outlined">创建用户名</button>
				<p></p>
				<p></p>
				<div id="info"></div>
				<p></p>
				<button type='button' class="mui-btn mui-btn-blue mui-btn-outlined" onClick =abc() >今天的赌博日期</button>
				<p></p>
				<p></p>
				<div id="show"></div>
				<p></p>
			  <button id='goBtn' type="button" class="mui-btn mui-btn-blue mui-btn-outlined">go!</button>
			
			</div>
			<div id="gamego" style="margin: 5px;text-align: left;display: none;" >
				
				<hr style="height:1px;border:none;border-top:1px solid #555555;" />
				<h3>记账开始：</h1>
				<div >
				<h4 id="round">Round1</h4>
				<input  id="score" type="text" onkeyup="this.value=this.value.replace(/[^\-?\d.]/g,'')" placeholder="请输入">
			<button id="30" type="text">30</button>
			<button id="40" type="text">40</button>
			<button id="50" type="text">50</button>
			<button id="60" type="text">60</button>
			<button id="80" type="text">80</button>
			<button id="100" type="text">100</button>
			<button id="120" type="text">120</button>
			<p></p>
				<p></p>
			<button id="-30" type="text">-30</button>
			<button id="-40" type="text">-40</button>
			<button id="-50" type="text">-50</button>
			<button id="-60" type="text">-60</button>
			<button id="-80" type="text">-80</button>
			<button id="-100" type="text">-100</button>
			<button id="-120" type="text">-120</button>
			<p></p>
				<p></p>
				<button id="tijiao" type="submit">Submit</button>
				</div>
				<p></p>
				<p></p>
<p></p><p></p><p></p><p></p><p></p><p></p>
				<p></p>

				<p></p>
	<p></p>
				<button id="presult" type="submit" >查看个人结果</button>
				<p></p><p></p><p></p><p></p><p></p><p></p>
       <button id="tresult" type="submit" >查看所有人结果</button>

				</div>


<script type="text/javascript" charset="utf-8">
			//mui初始化
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});
			Bmob.initialize("67319233244b642700a8a8ff1bc41bcb","5e06930f59df39e859f648294171c1c2","3bc9e112b1541b6eda8d5f1d27fa2d89")
		
		
			document.getElementById("promptBtn").addEventListener('tap', function(e) {
				var info1 = document.getElementById("info");

				e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
				var btnArray = ['取消', '确定'];
				mui.prompt('请输入你炫酷的昵称：', '', 'hello', btnArray, function(e) {
					if (e.index == 1) {
						info1.innerText =e.value;
					} 
				})
			});
			document.getElementById("-30").addEventListener('tap', function() {
			document.getElementById("score").value =-30;
					}    
				);
				document.getElementById("-40").addEventListener('tap', function() {
				document.getElementById("score").value =-40;
						}    
					);
					document.getElementById("-50").addEventListener('tap', function() {
					document.getElementById("score").value =-50;
							}    
						);
						document.getElementById("-60").addEventListener('tap', function() {
						document.getElementById("score").value =-60;
								}    
							);
							document.getElementById("-80").addEventListener('tap', function() {
							document.getElementById("score").value =-80;
									}    
								);
								document.getElementById("-100").addEventListener('tap', function() {
								document.getElementById("score").value =-100;
										}    
									);
			document.getElementById("-120").addEventListener('tap', function() {
			document.getElementById("score").value =-120;
					}    
				);
				document.getElementById("120").addEventListener('tap', function() {
				document.getElementById("score").value =120;
						}    
					);
					document.getElementById("30").addEventListener('tap', function() {
			     document.getElementById("score").value =30;
							 }    
						);
						document.getElementById("40").addEventListener('tap', function() {
						document.getElementById("score").value =40;
								}    
							);
							document.getElementById("50").addEventListener('tap', function() {
							document.getElementById("score").value =50;
									}    
								);
								document.getElementById("60").addEventListener('tap', function() {
								document.getElementById("score").value =60;
										}    
									);
									document.getElementById("80").addEventListener('tap', function() {
									document.getElementById("score").value =80;
											}    
										);
										document.getElementById("100").addEventListener('tap', function() {
										document.getElementById("score").value =100;
												}    
											);
										
			document.getElementById("goBtn").addEventListener('tap', function() {
				var info1 = document.getElementById("info").innerHTML;
				var show = document.getElementById("show").innerHTML;
				var oDiv = document.getElementById("gamego");
				var oDiv1 = document.getElementById("goBtn");
         if(info1==""||show==""){	mui.toast("炫酷id和赌博日期不能为空");
				 }else{
					 oDiv.style.display="block";
					 oDiv1.style.display="none";
					

				 }
          
			});
			var score1;
			document.getElementById("tijiao").addEventListener('tap', function() {
						
							 score1 = $("#score").val();
						
			         if(score1==""){	mui.toast("分数不能为空");
							 }else{
								 sendMsg();
								 var round = document.getElementById("round").innerHTML;
                     document.getElementById('score').value = "";
									 document.getElementById("round").innerHTML="Round"+(parseInt(round.replace(/[^0-9]/ig,""))+1);
			
							 }
			          
						});
						document.getElementById("presult").addEventListener('tap', function() {

                 selectMsg();
						});
			document.getElementById("tresult").addEventListener('tap', function() {
		
           selectTMsg()
								});
								
					
		function selectTMsg(){
					
						var show = document.getElementById("show").innerHTML;
					var GameScore = Bmob.Object.extend("cards");
					var query = new Bmob.Query(GameScore);
	
		query.equalTo("room",show); 
		
		// 查询所有数据
		query.find({
		    success: function(results) {
		
				      var arr=new Array();
		        // 循环处理查询到的数据
		        for (var i = 0; i < results.length; i++) {
		        var object = results[i].get("name");
					  if(arr.indexOf(object)==-1){
							arr.push(object)
						}
		      
		
		        }
				bianli(arr);

						
		    },
		    error: function(error) {
		        alert("查询失败: " + error.code + " " + error.message);
		    }
		});
					}
			var ss="";
				
  function bianli(arr){
		  var str="";
			
			for(var i=0;i<arr.length;i++){
				var name=arr[i];
				 var info=bianli2(name);
				 
				
		}
		alert(ss);
		ss="";
	}

	
				function bianli2(name){
					
				var show = document.getElementById("show").innerHTML;
				var GameScore = Bmob.Object.extend("cards");
				var query = new Bmob.Query(GameScore);
				var str="";
	query.equalTo("name", name); 
	query.equalTo("room",show); 
	
	// 查询所有数据
	query.find({
	    success: function(results) {
	
			      var sum=0;
	        // 循环处理查询到的数据
	        for (var i = 0; i < results.length; i++) {
	        var object = results[i];
				   var s=parseInt(object.get("score"));
					sum =s+sum;
	     
	
	        }
			     str=name+",您今天的总得分:"+sum+"\n";
					 ss+=str;
	
					
	    },
	    error: function(error) {
	        alert("查询失败: " + error.code + " " + error.message);
	    }
	});
	
	
				}
	

			function selectMsg(){
				var info1 = document.getElementById("info").innerHTML;
				var show = document.getElementById("show").innerHTML;
			var GameScore = Bmob.Object.extend("cards");
			var query = new Bmob.Query(GameScore);
query.equalTo("name", info1); 
query.equalTo("room",show); 

// 查询所有数据
query.find({
    success: function(results) {

		      var sum=0;
        // 循环处理查询到的数据
        for (var i = 0; i < results.length; i++) {
        var object = results[i];
			   var s=parseInt(object.get("score"));
				sum =s+sum;
     

        }
			alert(info1+"您今天的总得分:"+sum);

				
    },
    error: function(error) {
        alert("查询失败: " + error.code + " " + error.message);
    }
});
			}
			
		
			
						
			
			
			
		function sendMsg(){
		       
		       var info1 = document.getElementById("info").innerHTML;
		       var show = document.getElementById("show").innerHTML;
		       
		       var round = document.getElementById("round").innerHTML;
 
		
		        var Chat = Bmob.Object.extend("cards");
		        var chat = new Chat();
		        chat.set("name", info1);
		        chat.set("room", show);
						chat.set("round", round);
						chat.set("score", score1);


		        chat.save(null, {
		          success: function(object) { 
								mui.toast("ok");
		          },
		          error: function(model, error) {     
								mui.toast("error");

		          }
		        });     
		    }
		
		
		</script>
		
		 
		
</body>
</html>
